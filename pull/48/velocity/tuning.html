<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-velocity docs-doc-id-admin/how-to/tuning">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.18">
<meta name="robots" content="noindex, nofollow">
<link rel="icon" href="/docs-previews/pull/48/img/paper.png">
<link rel="manifest" href="/docs-previews/pull/48/manifest.json">
<meta name="theme-color" content="rgb(0, 78, 233)">
<script type="application/ld+json">{"@context":"https://schema.org","@type":"WebSite","url":"https://papermc.github.io/docs-previews/pull/48/","potentialAction":{"@type":"SearchAction","target":{"@type":"EntryPoint","urlTemplate":"https://papermc.github.io/docs-previews/pull/48/search?q={search_term_string}"},"query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" title="PaperMC Documentation" href="/docs-previews/pull/48/opensearch.xml"><title data-rh="true">Tuning Velocity | PaperMC Documentation</title><meta data-rh="true" property="og:image" content="https://papermc.github.io/docs-previews/pull/48/img/og-image.png"><meta data-rh="true" name="twitter:image" content="https://papermc.github.io/docs-previews/pull/48/img/og-image.png"><meta data-rh="true" property="og:url" content="https://papermc.github.io/docs-previews/pull/48/velocity/tuning"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="twitter:card" content="summary"><meta data-rh="true" name="og:type" content="website"><meta data-rh="true" name="og:image:alt" content="PaperMC Logo"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-velocity-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-velocity-current"><meta data-rh="true" property="og:title" content="Tuning Velocity | PaperMC Documentation"><meta data-rh="true" name="description" content="Velocity comes with good performance out of the box. We go in deep, starting from smart algorithmic"><meta data-rh="true" property="og:description" content="Velocity comes with good performance out of the box. We go in deep, starting from smart algorithmic"><link data-rh="true" rel="icon" href="/docs-previews/pull/48/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://papermc.github.io/docs-previews/pull/48/velocity/tuning"><link data-rh="true" rel="alternate" href="https://papermc.github.io/docs-previews/pull/48/velocity/tuning" hreflang="en"><link data-rh="true" rel="alternate" href="https://papermc.github.io/docs-previews/pull/48/velocity/tuning" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://P1BCDPTG1Q-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/docs-previews/pull/48/assets/css/styles.fb34280f.css">
<link rel="preload" href="/docs-previews/pull/48/assets/js/runtime~main.dea6a3fb.js" as="script">
<link rel="preload" href="/docs-previews/pull/48/assets/js/main.4fdc7a79.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,e("light"))}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_D7fD">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/docs-previews/pull/48/"><div class="navbar__logo"><img src="/docs-previews/pull/48/img/logo-marker-light.svg" alt="PaperMC Docs" class="themedImage_ulx3 themedImage--light_SuOr" height="32" width="130"><img src="/docs-previews/pull/48/img/logo-marker-dark.svg" alt="PaperMC Docs" class="themedImage_ulx3 themedImage--dark_CqOL" height="32" width="130"></div></a><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/docs-previews/pull/48/paper">Paper</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs-previews/pull/48/paper/admin">Administration</a></li><li><a class="dropdown__link" href="/docs-previews/pull/48/paper/dev">Development</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a aria-current="page" class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/docs-previews/pull/48/velocity">Velocity</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs-previews/pull/48/velocity/admin">Administration</a></li><li><a class="dropdown__link" href="/docs-previews/pull/48/velocity/dev">Development</a></li></ul></div><a class="navbar__item navbar__link" href="/docs-previews/pull/48/waterfall">Waterfall</a><a class="navbar__item navbar__link" href="/docs-previews/pull/48/misc">Misc</a></div><div class="navbar__items navbar__items--right"><a href="https://papermc.io/downloads" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Downloads</a><a href="https://discord.gg/PaperMC" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-icon-link header-discord-link"></a><a href="https://github.com/PaperMC" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-icon-link header-github-link"></a><div class="toggle_tJxu colorModeToggle_Tosf"><button class="clean-btn toggleButton_KDcG toggleButtonDisabled_nBdM" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_J4Jb"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_V9Zd"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_O4ya"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper"><div class="docPage_Sq36"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_jn3u" type="button"></button><aside class="theme-doc-sidebar-container docSidebarContainer_Myfv"><div class="sidebar_rmcy"><nav class="menu thin-scrollbar menu_AgZX"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs-previews/pull/48/velocity">Welcome to the Velocity Docs</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs-previews/pull/48/velocity/admin">Administration</a><button aria-label="Toggle the collapsible sidebar category &#x27;Administration&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="true" tabindex="0" href="/docs-previews/pull/48/velocity/getting-started">Getting Started</a><button aria-label="Toggle the collapsible sidebar category &#x27;Getting Started&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs-previews/pull/48/velocity/getting-started">Getting Started</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs-previews/pull/48/velocity/why-velocity">What Does Velocity Do For Me?</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs-previews/pull/48/velocity/player-information-forwarding">Configuring player information forwarding</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs-previews/pull/48/velocity/faq">Frequently Asked Questions</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/docs-previews/pull/48/velocity/cat/admin/how-to-guides">How-to Guides</a><button aria-label="Toggle the collapsible sidebar category &#x27;How-to Guides&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs-previews/pull/48/velocity/security">Securing Your Servers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs-previews/pull/48/velocity/tuning">Tuning Velocity</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs-previews/pull/48/velocity/migration">Migration Guide</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="true" tabindex="0" href="/docs-previews/pull/48/velocity/cat/admin/reference">Reference</a><button aria-label="Toggle the collapsible sidebar category &#x27;Reference&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs-previews/pull/48/velocity/configuration">Configuring Velocity</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs-previews/pull/48/velocity/built-in-commands">Built-In Commands</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs-previews/pull/48/velocity/server-compatibility">Server Compatibility</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs-previews/pull/48/velocity/comparisons-to-other-proxies">Comparing With Other Proxies</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs-previews/pull/48/velocity/credits">Libraries Used</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs-previews/pull/48/velocity/dev">Development</a><button aria-label="Toggle the collapsible sidebar category &#x27;Development&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></aside><main class="docMainContainer_bvqz"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_mKZd"><div class="docItemContainer_xnbY"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Alpn" aria-label="breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/docs-previews/pull/48/">üè†</a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs-previews/pull/48/velocity/admin"><span itemprop="name">Administration</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs-previews/pull/48/velocity/cat/admin/how-to-guides"><span itemprop="name">How-to Guides</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Tuning Velocity</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_wQD_ theme-doc-toc-mobile tocMobile_mfPC"><button type="button" class="clean-btn tocCollapsibleButton_vhjt">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Tuning Velocity</h1><p>Velocity comes with good performance out of the box. We go in deep, starting from smart algorithmic
choices, making strategic usage of native libraries, all the way to the JVM level, optimizing the
proxy so that the JVM will make better decisions when optimizing the code.</p><h2 class="anchor anchorWithStickyNavbar__eKV" id="host-the-proxy-on-linux">Host the proxy on Linux<a class="hash-link" href="#host-the-proxy-on-linux" title="Direct link to heading">‚Äã</a></h2><p>Velocity comes with high-performance, specially tuned native libraries for compression and
encryption, along with including native transports from Netty. However, due to support constraints,
the compiled natives are only verified to work on Linux x86_64 and aarch64. While Velocity does not
require the natives to work, you will suffer from degraded performance. For this reason, we strongly
recommend that all production deployments of Velocity run on x86-64 Linux.</p><h2 class="anchor anchorWithStickyNavbar__eKV" id="allocate-server-resources-appropriately">Allocate server resources appropriately<a class="hash-link" href="#allocate-server-resources-appropriately" title="Direct link to heading">‚Äã</a></h2><p>You should always make sure to allocate the correct amount of heap, network bandwidth, and get the
right CPU for the amount of players you want to have on your proxy at a given time. For instance, it
is unlikely you&#x27;ll be able to get 1,000 players on a Raspberry Pi Zero, but you&#x27;ll have a much
better chance if you have a recent high-end server CPU from Intel or AMD.</p><p>There is no &quot;one-size-fits-all&quot; hardware recommendation, only general guidelines for the amount of
players you can expect:</p><ul><li>Prefer lots of cores but lower clock speeds. Unlike the Minecraft server, Velocity can actually
benefit from the extra cores and single-threaded performance is not as important.</li><li>You should always have enough memory to run Velocity, including room for JVM overhead and for your
operating system. For a rough minimum recommended memory amount, double the size of the proxy heap
and then add 2GB. For instance, for a proxy with a 2GB heap, plan on getting at least 6GB of
memory.</li><li>Disk speed is unimportant. A solid-state drive is nice to have but not strictly required.
Likewise, disk capacity is unimportant as well.</li></ul><h3 class="anchor anchorWithStickyNavbar__eKV" id="special-notes-regarding-speculative-execution-security-vulnerabilities">Special notes regarding speculative execution security vulnerabilities<a class="hash-link" href="#special-notes-regarding-speculative-execution-security-vulnerabilities" title="Direct link to heading">‚Äã</a></h3><p>Starting in 2018, a number of security vulnerabilities with regard to
<a href="https://en.wikipedia.org/wiki/Speculative_execution" target="_blank" rel="noopener noreferrer">speculative execution</a> used by modern CPUs
have been discovered.</p><p>The mitigations to these vulnerabilities can have painful performance implications, especially on
processors vulnerable to Meltdown and further compounded if running in a virtual machine. Velocity,
as a network application, is particularly sensitive to the performance hits that the mitigations
introduce.</p><p>To minimize these hits, we recommend hosting your proxy on a machine with a CPU that has mitigations
against Spectre and Meltdown. Processors released in 2019 and onwards typically contain mitigations
to protect against Spectre and Meltdown.</p><p>If you are using a CPU vulnerable to Spectre and/or Meltdown and are willing to risk security for
performance, it is also possible to disable Spectre/Meltdown mitigations depending on the operating
system you use. Note however that you disable these security mitigations <em>at your own risk</em>. The
Velocity project does not recommend that you disable these mitigations.</p><h2 class="anchor anchorWithStickyNavbar__eKV" id="allocate-enough-heap">Allocate enough heap<a class="hash-link" href="#allocate-enough-heap" title="Direct link to heading">‚Äã</a></h2><p>Alongside having enough CPU, memory, and network bandwidth, you must also allocate enough Java heap
to the proxy. Not doing this can induce lag and in severe cases may result in the proxy being
terminated by the Java Virtual Machine because it ran out of memory.</p><p>The general rule of thumb is that you allocate 512MB per 500 players, plus some extra to allow for
some room for error ( typically 1GB extra). For instance, if you want to handle 1,000 on a single
proxy, plan to allocate 2GB of heap.</p><h3 class="anchor anchorWithStickyNavbar__eKV" id="special-notes-for-containers">Special notes for containers<a class="hash-link" href="#special-notes-for-containers" title="Direct link to heading">‚Äã</a></h3><p><strong>If you use a containerized setup (such as using Kubernetes, Pterodactyl, or Docker directly), you
should not allocate the entirety of your memory allocation to the heap!</strong> Doing so <em>will</em> likely
cause the proxy to be killed by the kernel&#x27;s out-of-memory killer, which will result in your proxy
going down, likely at the worst possible time.</p><p>A safe (albeit conservative) setting for the heap would be to allocate half of the memory you
allocate to the proxy container in total. For instance, if you know the proxy will need to hold
1,000 players, then allocate 4GB to the container and give the proxy 2GB of heap.</p><h2 class="anchor anchorWithStickyNavbar__eKV" id="tune-your-startup-flags">Tune your startup flags<a class="hash-link" href="#tune-your-startup-flags" title="Direct link to heading">‚Äã</a></h2><p>We also recommend tuning your startup flags. The current recommendation is:</p><div class="codeBlockContainer_X7hc theme-code-block"><div class="codeBlockContent_vqWU" style="color:#9CDCFE;background-color:#1E1E1E"><pre tabindex="0" class="prism-code language-text codeBlock_wPnj thin-scrollbar"><code class="codeBlockLines_fQUY"><span class="token-line" style="color:#9CDCFE"><span class="token plain">-XX:+UseG1GC -XX:G1HeapRegionSize=4M -XX:+UnlockExperimentalVMOptions -XX:+ParallelRefProcEnabled -XX:+AlwaysPreTouch -XX:MaxInlineLevel=15</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eICi clean-btn"><span class="copyButtonIcons_zMKT" aria-hidden="true"><svg class="copyButtonIcon_IkKm" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_Jy9O" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>You will add these flags after the <code>java</code> command but before the <code>-jar</code> parameter.</p><h3 class="anchor anchorWithStickyNavbar__eKV" id="explanation-of-the-flags">Explanation of the flags<a class="hash-link" href="#explanation-of-the-flags" title="Direct link to heading">‚Äã</a></h3><p>Most of these flags focus on tuning the G1 garbage collector to be more friendly to Velocity&#x27;s
workload. One of these flags (<code>-XX:MaxInlineLevel=15</code>) tends to improve performance in general.</p><p>Before the release of Java 9, the default Java garbage collector was the Parallel GC. This is a
stop-the-world collector that does its work in parallel. The problem is that its pause times tend to
be long, and are not suitable for Minecraft (often showing up as seemingly unexplainable lag
spikes).</p><p>The recommended garbage collector for Velocity is the G1 region-based collector. There are several
reasons for us to recommend G1:</p><ul><li>It strikes the right balance between throughput and pause times. Throughput is roughly how much
work the proxy can achieve.</li><li>It is compatible with most setups (it is available in Java 8, the earliest Java version we
support).</li></ul><p>Setups using these flags tend have very low (less than 10 millisecond) GC pauses every few minutes,
which is very good for Minecraft.</p><h3 class="anchor anchorWithStickyNavbar__eKV" id="other-configurations">Other configurations<a class="hash-link" href="#other-configurations" title="Direct link to heading">‚Äã</a></h3><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</h5></div><div class="admonition-content"><p>Deviating from the configuration we recommend is done solely at your own risk.</p></div></div><p>Velocity is an application that tends to follow the generational hypothesis quite closely. It has
also been tuned to reduce load on the garbage collector as much as possible.</p><h4 class="anchor anchorWithStickyNavbar__eKV" id="zgc">ZGC<a class="hash-link" href="#zgc" title="Direct link to heading">‚Äã</a></h4><p>ZGC (the Z Garbage Collector), introduced with Java 11 and stabilized with Java 15, has proven to be
successful for one large-scale deployment of Velocity.</p><p>At its core, ZGC is a concurrent, generation-less garbage collector emphasizing low latency at the
expense of throughput. Given the nature of Velocity as a network proxy where low throughput and high
throughput are important, we recommend using ZGC with caution, and only if you use Java 15 or above.</p><p>The primary tuning flag for ZGC is heap size - if ZGC cannot collect garbage faster than the proxy
can allocate it, the threads generating garbage will be temporarily paused, causing the proxy to
appear to be laggy. Our heap size recommendations still apply, but prepare to give the proxy more
memory if necessary.</p><h4 class="anchor anchorWithStickyNavbar__eKV" id="shenandoah">Shenandoah<a class="hash-link" href="#shenandoah" title="Direct link to heading">‚Äã</a></h4><p>Introduced in Java 11 and declared stable in Java 15, Shenandoah is similar to G1 in being a
concurrent, generational garbage collector, but it does more work in parallel.</p><p>The Velocity team is not aware of any successful deployments of Shenandoah with Velocity in the
wild.</p><h4 class="anchor anchorWithStickyNavbar__eKV" id="openj9">OpenJ9<a class="hash-link" href="#openj9" title="Direct link to heading">‚Äã</a></h4><p>OpenJ9 is an alternative to the HotSpot JVM derived from IBM&#x27;s J9 JVM, focused primarily on cloud
workloads. As a result, it behaves very differently from HotSpot. Correspondingly, it has a
completely different set of garbage collectors.</p><p>The default <code>gencon</code> garbage collector should work fine with Velocity.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/PaperMC/docs/blob/main/docs/admin/how-to/tuning.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_r8mS" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_R3aZ"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2022-04-10T19:29:54.000Z">4/10/2022</time></b> by <b>Evan McCarthy</b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs-previews/pull/48/velocity/security"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Securing Your Servers</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs-previews/pull/48/velocity/migration"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Migration Guide</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_yVi_ thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#host-the-proxy-on-linux" class="table-of-contents__link toc-highlight">Host the proxy on Linux</a></li><li><a href="#allocate-server-resources-appropriately" class="table-of-contents__link toc-highlight">Allocate server resources appropriately</a><ul><li><a href="#special-notes-regarding-speculative-execution-security-vulnerabilities" class="table-of-contents__link toc-highlight">Special notes regarding speculative execution security vulnerabilities</a></li></ul></li><li><a href="#allocate-enough-heap" class="table-of-contents__link toc-highlight">Allocate enough heap</a><ul><li><a href="#special-notes-for-containers" class="table-of-contents__link toc-highlight">Special notes for containers</a></li></ul></li><li><a href="#tune-your-startup-flags" class="table-of-contents__link toc-highlight">Tune your startup flags</a><ul><li><a href="#explanation-of-the-flags" class="table-of-contents__link toc-highlight">Explanation of the flags</a></li><li><a href="#other-configurations" class="table-of-contents__link toc-highlight">Other configurations</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://discord.gg/papermc" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_QP8I"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://forums.papermc.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">Forums<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_QP8I"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://webchat.esper.net/?channels=paper" target="_blank" rel="noopener noreferrer" class="footer__link-item">IRC<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_QP8I"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Documentation</div><ul class="footer__items"><li class="footer__item"><a href="https://papermc.io/javadocs" target="_blank" rel="noopener noreferrer" class="footer__link-item">Javadoc<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_QP8I"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/docs-previews/pull/48/">Docs</a></li><li class="footer__item"><a href="https://papermc.io/api/docs" target="_blank" rel="noopener noreferrer" class="footer__link-item">Downloads API<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_QP8I"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Other</div><ul class="footer__items"><li class="footer__item"><a href="https://papermc.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">Main Site<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_QP8I"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/PaperMC" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_QP8I"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright ¬© 2022 PaperMC and Contributors. Built with Docusaurus.</div></div></div></footer></div>
<script src="/docs-previews/pull/48/assets/js/runtime~main.dea6a3fb.js"></script>
<script src="/docs-previews/pull/48/assets/js/main.4fdc7a79.js"></script>
</body>
</html>